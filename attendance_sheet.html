<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Attendance Sheet - Mewar App</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="panel">
    <h2>Attendance Records</h2>
    <label for="filterClass">Filter by Class:</label>
    <select id="filterClass" onchange="filterAttendance()">
      <option value="">All Classes</option>
      <option value="1st">1st</option>
      <option value="2nd">2nd</option>
      <option value="3rd">3rd</option>
      <option value="4th">4th</option>
      <option value="5th">5th</option>
      <option value="6th">6th</option>
      <option value="7th">7th</option>
      <option value="8th">8th</option>
      <option value="9th">9th</option>
      <option value="10th">10th</option>
      <option value="11th PCM">11th PCM</option>
      <option value="11th PCB">11th PCB</option>
      <option value="11th Commerce">11th Commerce</option>
      <option value="11th Agriculture">11th Agriculture</option>
      <option value="12th PCM">12th PCM</option>
      <option value="12th PCB">12th PCB</option>
      <option value="12th Commerce">12th Commerce</option>
      <option value="12th Agriculture">12th Agriculture</option>
    </select>

    <div id="attendanceData"></div>
  </div>

  <script>
    const attendance = JSON.parse(localStorage.getItem("attendance")) || [];

    function filterAttendance() {
      const selectedClass = document.getElementById("filterClass").value;
      const displayDiv = document.getElementById("attendanceData");
      displayDiv.innerHTML = "";

      const filtered = selectedClass
        ? attendance.filter(record => record.class === selectedClass)
        : attendance;

      if (filtered.length === 0) {
        displayDiv.innerHTML = "<p>No attendance records found.</p>";
        return;
      }

      filtered.forEach(record => {
        const present = record.records.filter(r => r.status === "Present").length;
        const total = record.records.length;
        const percent = ((present / total) * 100).toFixed(2);

        let table = `<h3>Date: ${record.date} | Class: ${record.class} | Teacher ID: ${record.empID}</h3>`;
        table += `<table border="1" width="100%">
                    <tr>
                      <th>Student Name</th>
                      <th>Roll No</th>
                      <th>Status</th>
                    </tr>`;

        record.records.forEach(r => {
          const rowColor = r.status === "Absent" ? " style='color:red'" : "";
          table += `<tr${rowColor}><td>${r.name}</td><td>${r.rollNo}</td><td>${r.status}</td></tr>`;
        });

        table += `</table><p><strong>Present %:</strong> ${percent}%</p>`;
        if (percent < 75) {
          table += `<p style='color:red'><strong>ALERT:</strong> Attendance below 75%</p>`;
        }

        displayDiv.innerHTML += table + "<hr>";
      });
    }

    filterAttendance();
  </script>
</body>
</html>
